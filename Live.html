<html>

  <head>
    <style>
    body {
      margin: 0px
    }

    button {
      border-radius: 5px;
      border: solid 1px lightgray;
      background-color: lightcyan;
      padding-left: 10px;
      padding-right: 10px;
      padding-top: 5px;
      padding-bottom: 5px;
    }

    select {
      border-radius: 5px;
      border: solid 1px lightgray;
      background-color: lightcyan;
      padding-left: 5px;
      padding-right: 5px;
      padding-top: 5px;
      padding-bottom: 5px;
    }

    .playerFrame {
      border: none;
      visibility: visible;
      width: 480;
      height: 270;
      min-width: 480;
      min-height: 270;
    }

    .playerContainer{
      float: left;
    }

    .rightTopControl {
      position: absolute;
      top: 0px;
      right: 0px;
    }

    .rButton {
      position: relative;
      float: left;
      top: 0px;
      
      width: 20px;
      height: 20px;
      background-image: url('/iXwrYnS92WB.png');
      background-position: -21px -572px;
     font-family: Arial Unicode MS;
      color: white;
      margin: 5px;
      text-align: center;
      cursor: hand;
    }

    .soundSoloButton {
      position: relative;
      float: left;
      top: 0px;      
      width: 20px;
      height: 20px;
      font-family: Arial Unicode MS;
      color: white;
      margin: 5px;
      text-align: center;
      cursor: hand;
      background-image: url('/iXwrYnS92WB.png');
      background-position: -42px -467px;
    }

    .fb-video {
      float: left;
      position: relative;

    }

    .panelTable {
      display: table;
      box-shadow: 0px 0px 2px 0px rgba(0, 0, 0, 0.75);
      width: 100%;
      min-width: 480;
      /*   margin-bottom: 20px;*/
    }

    .panelTable div {
      display: table-row;
    }

    .panelTable div div {
      display: table-cell;
      padding: 10px;
    }
  </style>
  </head>

  <body>
    <script
      src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
    var vWidth = 480;
    var vHeight = vWidth / 16 * 9;
    var userLang = (navigator.language || navigator.userLanguage).replace("-", "_");
    var pID = 1;
    var vAutoplay = "false";
    var r;
    var players = Array();
    var playerDoc = "";


    window.fbAsyncInit = function () {
      fb_init();
    };

    (function (d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) { return; }
      js = d.createElement(s); js.id = id;
      js.src = "https://connect.facebook.net/" + userLang + "/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));


    $(document).ready(function () {
      r = $("#root")[0];
      window.onresize = function () {
        resized();
      }

    });

    function fb_init() {
      FB.init({
        appId: '{your-app-id}',
        status: true,
        xfbml: true,
        version: 'v2.7' // or v2.6, v2.5, v2.4, v2.3
      });

     /* FB.Canvas.startTimer();

      FB.Canvas.setDoneLoading(
        function (result) {
          console.log(result);
        }
      );*/

      FB.Event.subscribe('xfbml.render', function (msg) {
        fbPluginReadnered("Render");
      });

      var my_video_player;
      FB.Event.subscribe('xfbml.ready', function (msg) {
        //fbPluginReadnered("Ready");

        if (msg.type === 'video') {
          pushPlayer(msg);
          renderedPlayer(msg);
          //my_video_player = msg.instance;
          console.log(msg);
        }
      });


    }

    function fbPluginReadnered(msg) {
      console.log(msg);
    }

    function addPlayer(videoURL) {
      videoURL = prompt("Video URL or ID:");
      if (videoURL != null) {
        var vID = check(videoURL);
        if (vID != null) {
          var captionShown = document.getElementById("videoCaptionShown");
          captionShown = captionShown.options[captionShown.selectedIndex].value;

var c=document.createElement("DIV");
getWidth = getPlayerWidth();
      c.style.width = getWidth.width;
      c.className="playerContainer";

          var player = document.createElement("DIV");
          player.id = "player" + pID;
          player.setAttribute("class", "fb-video");
          player.setAttribute("data-href", videoURL);
          //a.setAttribute("data-width", vWidth);

          var b = document.createElement("DIV");
          //   a.appendChild(b);

      /*    var rButton = document.createElement("DIV");
          rButton.setAttribute("class", "rButton");
          rButton.addEventListener("click", function () { removePlayer(a) });
          rButton.innerText = "X";
*/

          var f = document.createElement("IFRAME");
          /*   f.addEventListener("DOMContentLoaded", function () {
               this.style.width = this.document.clientWidth;
             });*/
          f.setAttribute("src", "https://www.facebook.com/v3.3/plugins/video.php?mute=false&heught=270&autoplay=" + vAutoplay + "&href=https%3A%2F%2Fwww.facebook.com%2Fstandnewshk%2Fvideos%2F" + vID + "%2F&locale=" + userLang + "&sdk=joey&show_caption=true&show_text=" + captionShown);
          //f.setAttribute("src","about:blank");
          f.setAttribute("scrolling", "no");
          f.setAttribute("allowfullscreen", vAutoplay);
          f.setAttribute("class", "playerFrame");


          // f.contentDocument.document=createPlayerContent(videoURL);


          //b.appendChild(f);
       //   b.appendChild(rButton);
       c.appendChild(player);
          r.appendChild(c);
          //  players.push(f);





          /*  FB.Event.subscribe('xfbml.ready', function (msg) {
              fbPluginReadnered(msg);
              /*
              if (msg.type === 'video') {
                my_video_player = msg.instance;
                console.log(msg);
              }
            });*/


          FB.XFBML.parse(c, function () {
            console.log("Parsed");
          });


        //  b.appendChild(rButton);

          //  a.style.height = getWidth.height;

          pID++;
          // $(window).trigger('fbAsyncInit');
        }
        else {
          alert("Video URL or ID 可能無效。");
        }
      }
    }

    function renderedPlayer(plugin) {
      var element = document.getElementById(plugin.id);
      var aa = document.createElement("DIV");
      aa.className = "rightTopControl";


      var rButton = document.createElement("DIV");
      rButton.setAttribute("class", "rButton");
      rButton.addEventListener("click", function () { removePlayer(element) });    
      //rButton.innerText = "X";
      rButton.title = "Close";

      var soundSoloButton = document.createElement("DIV");
      soundSoloButton.className = "soundSoloButton";
      soundSoloButton.addEventListener("click", function () { soundSolo(plugin) });

      aa.appendChild(soundSoloButton);
      aa.appendChild(rButton);
      element.appendChild(aa);
     
    }

    function pushPlayer(plugin) {
      players.push(plugin);
    }

    function check(videoURL) {
      var urlRex = /.*facebook.com\/.*\/videos\/(\d+).*/
      var urlRex2 = /(\d+)/;

      let matches = videoURL.match(urlRex);
      let matches2 = videoURL.match(urlRex2);

      if (matches != null && matches.length == 2) {
        return matches[1];
      } else if (matches2 != null && matches2.length == 2) {
        return matches2[1];
      } else {
        return null;
      }
    }

    function removePlayer(element) {
      var i=0;
      players.forEach( ele=>{
        if(ele.id===element.id){
//break;
players.splice(i, 1);//pop(id.getElementsByTagName("IFRAME")[0]);
      r.removeChild(element.parentElement);
        }
i++;
      } );
  //    var i = players.indexOf(id);
    
    }

    function getPlayerWidth() {
      var FramePerRow = document.getElementById("FramePerRow").options[document.getElementById("FramePerRow").selectedIndex].value;
      $("#root")[0].style.width = window.innerWidth;
      if ($("#root")[0].clientWidth != document.body.clientWidth) {
        $("#root")[0].style.width = document.body.clientWidth;
      }

      var w = Math.floor($("#root")[0].clientWidth / FramePerRow)
      var h = Math.floor(w / 16 * 9);
      return { width: w, height: h };
    }

    function resized() {
      var getWidth = getPlayerWidth();
      var newWidth = getWidth.width;
      var newHeight = getWidth.height;

      for (i = 0; i < players.length; i++) {
        var element = document.getElementById(players[i].id).parentElement;
        if(element!=null){
        element.style.width = newWidth;
        }
        //  element.style.height = newHeight;
      }
      players.forEach(element => {

      });


      /*
      var elem,
      style;
      elem = document.querySelector('.playerFrame');
      style = getComputedStyle(elem);
      var newWidth = document.clientWidth / 4;
      var newHeight = newWidth / 16 * 9;
      style.width = newWidth; //`20px`
      style.height = newHeight; //`20px` */
    }

    function muteAll() {
      players.forEach(element => {

        /* var vp = element.getElementsByTagName("video")[0];
        vp.mute = true;*/
        element.instance.mute();
      });
    }

    function unmuteAll() {
      players.forEach(element => {

        /* var vp = element.getElementsByTagName("video")[0];
        vp.mute = true;*/
        element.instance.unmute();
      });
    }

    function soundSolo(plugin) {
      muteAll();
      plugin.instance.unmute();
    }

    function fullscreen() {
      if (window.innerHeight == screen.height) {
        // browser is fullscreen
        closeFullscreen();
      }
      else {
        openFullscreen();
      }
    }

    var elem = document.documentElement;

    /* View in fullscreen */
    function openFullscreen() {
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.mozRequestFullScreen) { /* Firefox */
        elem.mozRequestFullScreen();
      } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) { /* IE/Edge */
        elem.msRequestFullscreen();
      }
    }

    /* Close fullscreen */
    function closeFullscreen() {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.mozCancelFullScreen) { /* Firefox */
        document.mozCancelFullScreen();
      } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
        document.webkitExitFullscreen();
      } else if (document.msExitFullscreen) { /* IE/Edge */
        document.msExitFullscreen();
      }
    }
/*
        function createPlayerContent(videoURL) {
          var contentBody = document.createElement("BODY");
    
          var playerScript = document.createElement("SCRIPT");
          playerScript.setAttribute("src", "player.js");
    
    
          var fb_root = document.createElement("DIV");
          fb_root.id = "fb-root";
    
          var fb_video = document.createElement("DIV");
          fb_video.className = "fb-video"
          fb_video.setAttribute("data-href", videoURL);
          fb_video.setAttribute("data-allowfullscreen", true);
    
    
          contentBody.appendChild(playerScript);
          contentBody.appendChild(fb_root);
          contentBody.appendChild(fb_video);
    
          return contentBody;
        }*/
  </script>
    <div class="panelTable">
      <div>
        <div>
          <button onclick="addPlayer();">新增影片</button>
        </div>
        <div style="display: none">
          <span>Show Caption</span>
          <select id="videoCaptionShown">
            <option value="false">False</option>
            <option value="true">True</option>
          </select>
        </div>
        <div>
          Grid
          <select id="FramePerRow" onchange="resized();">
            <option value="4">4 x n</option>
            <option value="3">3 x n</option>
            <option value="2">2 x n</option>
            <option value="1">1 x n</option>
          </select>
        </div>
        <div>
          <button onclick="unmuteAll();">Unmute All</button>
        </div>

        <div>
          <button onclick="fullscreen();">FullScreen</button>
        </div>
      </div>
    </div>

    <div id="root" style="width: 100%">
      <div id="fb-root">
        <div id="t" class="fb-video">
          <div id="t1">

          </div>
        </div>
      </div>
      <!-- Your embedded video player code 
    <div class="fb-video" data-href="https://www.facebook.com/facebook/videos/10153231379946729/" data-width="500" data-allowfullscreen="true"></div>-->
    </div>

  </body>

</html>